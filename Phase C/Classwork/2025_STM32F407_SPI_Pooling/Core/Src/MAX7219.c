/*
 * MAX7219 RTC Module
 */

#include "MAX7219.h"

const uint8_t NUMBERS[][10] = {
  {0b00000000, 0b00001110, 0b00001010, 0b00001010, 0b00001010, 0b00001010, 0b00001110, 0b00000000},
  {0b00000000, 0b00000100, 0b00000100, 0b00000100, 0b00000100, 0b00000100, 0b00000100, 0b00000000},
  {0b00000000, 0b00001110, 0b00000010, 0b00001110, 0b00001000, 0b00001000, 0b00001110, 0b00000000},
  {0b00000000, 0b00001110, 0b00000010, 0b00001110, 0b00000010, 0b00000010, 0b00001110, 0b00000000},
  {0b00000000, 0b00001010, 0b00001010, 0b00001110, 0b00000010, 0b00000010, 0b00000010, 0b00000000},
  {0b00000000, 0b00001110, 0b00001000, 0b00001110, 0b00000010, 0b00000010, 0b00001110, 0b00000000},
  {0b00000000, 0b00001110, 0b00001000, 0b00001110, 0b00001010, 0b00001010, 0b00001110, 0b00000000},
  {0b00000000, 0b00001110, 0b00001010, 0b00000010, 0b00000010, 0b00000010, 0b00000010, 0b00000000},
  {0b00000000, 0b00001110, 0b00001010, 0b00001110, 0b00001010, 0b00001010, 0b00001110, 0b00000000},
  {0b00000000, 0b00001110, 0b00001010, 0b00001110, 0b00000010, 0b00000010, 0b00001110, 0b00000000},
  {0b00000000, 0b00101110, 0b00101010, 0b00101010, 0b00101010, 0b00101010, 0b00101110, 0b00000000},
  {0b00000000, 0b00100100, 0b00100100, 0b00100100, 0b00100100, 0b00100100, 0b00100100, 0b00000000},
  {0b00000000, 0b00101110, 0b00100010, 0b00101110, 0b00101000, 0b00101000, 0b00101110, 0b00000000},
  {0b00000000, 0b00101110, 0b00100010, 0b00101110, 0b00100010, 0b00100010, 0b00101110, 0b00000000},
  {0b00000000, 0b00101010, 0b00101010, 0b00101110, 0b00100010, 0b00100010, 0b00100010, 0b00000000},
  {0b00000000, 0b00101110, 0b00101000, 0b00101110, 0b00100010, 0b00100010, 0b00101110, 0b00000000},
  {0b00000000, 0b00101110, 0b00101000, 0b00101110, 0b00101010, 0b00101010, 0b00101110, 0b00000000},
  {0b00000000, 0b00101110, 0b00101010, 0b00100010, 0b00100010, 0b00100010, 0b00100010, 0b00000000},
  {0b00000000, 0b00101110, 0b00101010, 0b00101110, 0b00101010, 0b00101010, 0b00101110, 0b00000000},
  {0b00000000, 0b00101110, 0b00101010, 0b00101110, 0b00100010, 0b00100010, 0b00101110, 0b00000000},
  {0b00000000, 0b11101110, 0b00101010, 0b11101010, 0b10001010, 0b10001010, 0b11101110, 0b00000000},
  {0b00000000, 0b11100100, 0b00100100, 0b11100100, 0b10000100, 0b10000100, 0b11100100, 0b00000000},
  {0b00000000, 0b11101110, 0b00100010, 0b11101110, 0b10001000, 0b10001000, 0b11101110, 0b00000000},
  {0b00000000, 0b11101110, 0b00100010, 0b11101110, 0b10000010, 0b10000010, 0b11101110, 0b00000000},
  {0b00000000, 0b11101010, 0b00101010, 0b11101110, 0b10000010, 0b10000010, 0b11100010, 0b00000000},
  {0b00000000, 0b11101110, 0b00101000, 0b11101110, 0b10000010, 0b10000010, 0b11101110, 0b00000000},
  {0b00000000, 0b11101110, 0b00101000, 0b11101110, 0b10001010, 0b10001010, 0b11101110, 0b00000000},
  {0b00000000, 0b11101110, 0b00101010, 0b11100010, 0b10000010, 0b10000010, 0b11100010, 0b00000000},
  {0b00000000, 0b11101110, 0b00101010, 0b11101110, 0b10001010, 0b10001010, 0b11101110, 0b00000000},
  {0b00000000, 0b11101110, 0b00101010, 0b11101110, 0b10000010, 0b10000010, 0b11101110, 0b00000000},
  {0b00000000, 0b11101110, 0b00101010, 0b11101010, 0b00101010, 0b00101010, 0b11101110, 0b00000000},
  {0b00000000, 0b11100100, 0b00100100, 0b11100100, 0b00100100, 0b00100100, 0b11100100, 0b00000000},
  {0b00000000, 0b11101110, 0b00100010, 0b11101110, 0b00101000, 0b00101000, 0b11101110, 0b00000000},
  {0b00000000, 0b11101110, 0b00100010, 0b11101110, 0b00100010, 0b00100010, 0b11101110, 0b00000000},
  {0b00000000, 0b11101010, 0b00101010, 0b11101110, 0b00100010, 0b00100010, 0b11100010, 0b00000000},
  {0b00000000, 0b11101110, 0b00101000, 0b11101110, 0b00100010, 0b00100010, 0b11101110, 0b00000000},
  {0b00000000, 0b11101110, 0b00101000, 0b11101110, 0b00101010, 0b00101010, 0b11101110, 0b00000000},
  {0b00000000, 0b11101110, 0b00101010, 0b11100010, 0b00100010, 0b00100010, 0b11100010, 0b00000000},
  {0b00000000, 0b11101110, 0b00101010, 0b11101110, 0b00101010, 0b00101010, 0b11101110, 0b00000000},
  {0b00000000, 0b11101110, 0b00101010, 0b11101110, 0b00100010, 0b00100010, 0b11101110, 0b00000000},
  {0b00000000, 0b10101110, 0b10101010, 0b11101010, 0b00101010, 0b00101010, 0b00101110, 0b00000000},
  {0b00000000, 0b10100100, 0b10100100, 0b11100100, 0b00100100, 0b00100100, 0b00100100, 0b00000000},
  {0b00000000, 0b10101110, 0b10100010, 0b11101110, 0b00101000, 0b00101000, 0b00101110, 0b00000000},
  {0b00000000, 0b10101110, 0b10100010, 0b11101110, 0b00100010, 0b00100010, 0b00101110, 0b00000000},
  {0b00000000, 0b10101010, 0b10101010, 0b11101110, 0b00100010, 0b00100010, 0b00100010, 0b00000000},
  {0b00000000, 0b10101110, 0b10101000, 0b11101110, 0b00100010, 0b00100010, 0b00101110, 0b00000000},
  {0b00000000, 0b10101110, 0b10101000, 0b11101110, 0b00101010, 0b00101010, 0b00101110, 0b00000000},
  {0b00000000, 0b10101110, 0b10101010, 0b11100010, 0b00100010, 0b00100010, 0b00100010, 0b00000000},
  {0b00000000, 0b10101110, 0b10101010, 0b11101110, 0b00101010, 0b00101010, 0b00101110, 0b00000000},
  {0b00000000, 0b10101110, 0b10101010, 0b11101110, 0b00100010, 0b00100010, 0b00100010, 0b00000000},
  {0b00000000, 0b11101110, 0b10001010, 0b11101010, 0b00101010, 0b00101010, 0b11101110, 0b00000000},
  {0b00000000, 0b11100100, 0b10000100, 0b11100100, 0b00100100, 0b00100100, 0b11100100, 0b00000000},
  {0b00000000, 0b11101110, 0b10000010, 0b11101110, 0b00101000, 0b00101000, 0b11101110, 0b00000000},
  {0b00000000, 0b11101110, 0b10000010, 0b11101110, 0b00100010, 0b00100010, 0b11101110, 0b00000000},
  {0b00000000, 0b11101010, 0b10001010, 0b11101110, 0b00100010, 0b00100010, 0b11100010, 0b00000000},
  {0b00000000, 0b11101110, 0b10001000, 0b11101110, 0b00100010, 0b00100010, 0b11101110, 0b00000000},
  {0b00000000, 0b11101110, 0b10001000, 0b11101110, 0b00101010, 0b00101010, 0b11101110, 0b00000000},
  {0b00000000, 0b11101110, 0b10001010, 0b11100010, 0b00100010, 0b00100010, 0b11100010, 0b00000000},
  {0b00000000, 0b11101110, 0b10001010, 0b11101110, 0b00101010, 0b00101010, 0b11101110, 0b00000000},
  {0b00000000, 0b11101110, 0b10001010, 0b11101110, 0b00100010, 0b00100010, 0b11100010, 0b00000000}
};  // Numbers from 0 to 59

const int NUMBERS_LEN = sizeof(NUMBERS)/8;

void spiWriteRegister(SPI_HandleTypeDef *hspi, GPIO_TypeDef *cs_port, uint16_t cs_pin, uint8_t reg, uint8_t value) {
	uint8_t txData[2] = {reg, value};

	// Pull CS low to start communication
	HAL_GPIO_WritePin(cs_port, cs_pin, GPIO_PIN_RESET);
	// Send command and data
	HAL_SPI_Transmit(hspi, txData, 2, HAL_MAX_DELAY);
	// Pull CS high to end communication
	HAL_GPIO_WritePin(cs_port, cs_pin, GPIO_PIN_SET);

  /*
  SPI.beginTransaction(SPISettings(4000000, MSBFIRST, SPI_MODE0)); 
  digitalWrite(CS, LOW);  // start transfer  
  SPI.transfer(reg);  // Send address.
  SPI.transfer(value);  // Send the value.
  digitalWrite(CS, HIGH);  // Finish transfer.
  SPI.endTransaction();
  */
}



